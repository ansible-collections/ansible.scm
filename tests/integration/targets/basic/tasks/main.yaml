- name: Retrieve a repository from a distant location and make it available locally
  ansible.scm.git_here:
    origin:
      url: https://github.com/ansible-network/ansible.scm.git
  register: repository

- name: Add to the repository
  ansible.builtin.copy:
    content: "{{ repository | to_nice_yaml }}"
    dest: "{{ repository['path'] }}/details.yaml"

- name: Publish the changes
  ansible.scm.git_away:
    path: "{{ repository['path'] }}"
    token: "{{ lookup('env', 'GITHUB_TOKEN') }}"
